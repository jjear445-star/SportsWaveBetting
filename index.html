<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>VRFS SportsWave Bets</title>
<style>
body {background-color: #0f172a; color: white; font-family: Arial, sans-serif; padding: 20px;}
h1 {text-align: center; cursor: pointer; user-select: none;}
.game {background: #111827; padding: 15px; margin: 10px 0; border-radius: 10px;}
button {padding: 6px 12px; border: none; border-radius: 6px; background: #2563eb; color: white; cursor: pointer;}
button:disabled {background: gray; cursor: not-allowed;}
.admin-panel {background: #1f2937; padding: 15px; margin-top: 20px; border-radius: 10px;}
.log {background: #1e293b; padding: 10px; border-radius: 10px; margin-top: 20px;}
</style>
</head>
<body>

<h1 id="siteTitle">VRFS SportsWave Bets</h1>
<p>Balance: <span id="balance"></span> points</p>

<div id="games"></div>

<div class="log">
    <h3>Last 10 Bets</h3>
    <div id="betLog"></div>
</div>

<div id="adminPanel" class="admin-panel" style="display:none;">
    <h3>Admin Dashboard</h3>
    <button onclick="logoutAdmin()">Logout</button>
    
    <h4>Give Yourself Points</h4>
    <input type="number" id="givePointsAmount" placeholder="Points">
    <button onclick="givePoints()">Give Points</button>

    <h4>Create Game</h4>
    <input type="text" id="team1" placeholder="Team 1">
    <input type="text" id="team2" placeholder="Team 2">
    <button onclick="createGame()">Create Game</button>

    <h4>Update Score</h4>
    <div id="scoreUpdate"></div>

    <h4>Update Game Progress</h4>
    <div id="progressUpdate"></div>

    <h4>Start Game / Stop Betting</h4>
    <div id="startGameControls"></div>

    <h4>End Betting (Double Points / Refund Tie)</h4>
    <div id="endBetControls"></div>

    <h4>Delete Game</h4>
    <div id="deleteGameControls"></div>
</div>

<script>
let balance = parseInt(localStorage.getItem("balance")) || 10000;
let games = JSON.parse(localStorage.getItem("games")) || [
    { id: 1, team1: "Crystal Palace", team2: "Derby County", score1: 0, score2: 0, bettingOpen: true, progress: "Open" }
];
let bets = JSON.parse(localStorage.getItem("bets")) || [];
let betLog = JSON.parse(localStorage.getItem("betLog")) || [];
let isAdmin = localStorage.getItem("isAdmin") === "true";

let titleClickCount = 0; // title click counter
document.getElementById("siteTitle").addEventListener("click", () => {
    titleClickCount++;
    if(titleClickCount >= 10){
        let pass = prompt("Enter admin password:");
        if(pass === "vrfsbetvrfs717"){
            isAdmin = true;
            localStorage.setItem("isAdmin","true");
            showAdmin();
            alert("Admin access granted!");
        } else {
            alert("Wrong password!");
        }
        titleClickCount = 0;
    }
});

function saveData(){
    localStorage.setItem("balance", balance);
    localStorage.setItem("games", JSON.stringify(games));
    localStorage.setItem("bets", JSON.stringify(bets));
    localStorage.setItem("betLog", JSON.stringify(betLog));
}

function checkBalanceReset(){
    if(balance <= 0){
        balance = 100;
        saveData();
        updateBalance();
        alert("Your points reached 0. Reset to 100 points!");
    }
}

function updateBalance(){ document.getElementById("balance").innerText = balance; }

function renderGames(){
    checkBalanceReset();
    let container = document.getElementById("games");
    container.innerHTML = "";
    games.forEach(game=>{
        let hasBet = bets.find(b=>b.gameId===game.id);
        let status = game.bettingOpen?"Open":"Closed";
        let div = document.createElement("div");
        div.className="game";
        div.innerHTML=`
            <strong>${game.team1}</strong> vs <strong>${game.team2}</strong>
            <br>Score: ${game.score1} - ${game.score2}
            <br>Status: ${status}, Progress: ${game.progress}
            <br>
            <input type="number" id="betAmount${game.id}" placeholder="Points" ${hasBet || !game.bettingOpen || game.progress!=="Open"?"disabled":""}>
            <select id="betTeam${game.id}" ${hasBet || !game.bettingOpen || game.progress!=="Open"?"disabled":""}>
                <option value="${game.team1}">${game.team1}</option>
                <option value="${game.team2}">${game.team2}</option>
            </select>
            <button onclick="placeBet(${game.id})" ${hasBet || !game.bettingOpen || game.progress!=="Open"?"disabled":""}>Bet</button>
        `;
        container.appendChild(div);
    });
}

function renderBetLog(){
    let logContainer = document.getElementById("betLog");
    logContainer.innerHTML = betLog.slice(-10).map(entry=>`<p>${entry}</p>`).join("");
}

function placeBet(gameId){
    let game = games.find(g=>g.id===gameId);
    let amount = parseInt(document.getElementById(`betAmount${game.id}`).value);
    let team = document.getElementById(`betTeam${game.id}`).value;

    if(!amount || amount<=0) return alert("Enter a valid bet amount");
    if(amount>balance) return alert("You do not have enough points");
    if(bets.find(b=>b.gameId===game.id)) return alert("You already bet on this game");
    if(!game.bettingOpen || game.progress!=="Open") return alert("Betting is closed for this game");

    balance -= amount;
    updateBalance();

    bets.push({gameId:game.id, team, amount});
    betLog.push(`A user has placed a bet on ${team} with ${amount} point(s)`);

    saveData();
    renderGames();
    renderBetLog();
    checkBalanceReset();
}

function showAdmin(){
    document.getElementById("adminPanel").style.display="block";
    renderScoreUpdate();
    renderProgressUpdate();
    renderStartGameControls();
    renderEndBetControls();
    renderDeleteControls();
}

function logoutAdmin(){
    isAdmin=false;
    localStorage.removeItem("isAdmin");
    document.getElementById("adminPanel").style.display="none";
}

function renderScoreUpdate(){
    let container=document.getElementById("scoreUpdate"); container.innerHTML="";
    games.forEach(game=>{
        container.innerHTML+=`
            <div>
                ${game.team1} <input type="number" id="score1_${game.id}" value="${game.score1}">
                ${game.team2} <input type="number" id="score2_${game.id}" value="${game.score2}">
                <button onclick="updateScore(${game.id})">Update</button>
            </div>`;
    });
}
function updateScore(gameId){
    let game=games.find(g=>g.id===gameId);
    game.score1=parseInt(document.getElementById(`score1_${gameId}`).value);
    game.score2=parseInt(document.getElementById(`score2_${gameId}`).value);
    saveData();
    renderGames();
}

function renderProgressUpdate(){
    let container=document.getElementById("progressUpdate"); container.innerHTML="";
    games.forEach(game=>{
        container.innerHTML+=`
        <div>
            ${game.team1} vs ${game.team2}
            <select id="progress_${game.id}">
                <option value="Open" ${game.progress==="Open"?'selected':''}>Open</option>
                <option value="1st Half" ${game.progress==="1st Half"?'selected':''}>1st Half</option>
                <option value="Half Time" ${game.progress==="Half Time"?'selected':''}>Half Time</option>
                <option value="2nd Half" ${game.progress==="2nd Half"?'selected':''}>2nd Half</option>
                <option value="Extra Time" ${game.progress==="Extra Time"?'selected':''}>Extra Time</option>
                <option value="Pens" ${game.progress==="Pens"?'selected':''}>Pens</option>
                <option value="Closed" ${game.progress==="Closed"?'selected':''}>Closed</option>
            </select>
            <button onclick="updateProgress(${game.id})">Update Progress</button>
        </div>`;
    });
}
function updateProgress(gameId){
    let game=games.find(g=>g.id===gameId);
    game.progress=document.getElementById(`progress_${game.id}`).value;
    if(game.progress==="Closed") game.bettingOpen=false;
    saveData();
    renderGames(); renderProgressUpdate();
}

function givePoints(){
    let amount=parseInt(document.getElementById("givePointsAmount").value);
    if(amount>0){balance+=amount; saveData(); updateBalance();}
}

updateBalance();
renderGames();
renderBetLog();
if(isAdmin) showAdmin();
</script>

</body>
</html>
